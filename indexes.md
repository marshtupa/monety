# Индексы

ДЗ:

1. Проводим анализ возможных запросов\отчетов\поиска данных.
2. Предполагаем возможную кардинальность поля.
3. Создаем дополнительные индексы - простые или композитные.
4. На каждый индекс пишем краткое описание зачем он нужен (почему по этому полю\полям).
5. Думаем какие логические ограничения в БД нужно добавить - например какие поля должны быть уникальны, в какие нужно добавить условия, чтобы не нарушить бизнес логику. Пример - нельзя провести операцию по переводу средств на отрицательную сумму.
6. Создаем ограничения по выбранным полям.

## Отображение приложения:

**Запросы**:

1. Поиск пользователя по email
2. Получение настроек пользователя
3. Поиск всех активов пользователя (счета, депозиты, кредиты)
4. Получение целей пользователя.
5. Получение 100 последних транзакций
6. Получение категорий и подкатегорий пользователя.
7. Получение мест покупок.

**Индексы**:

1. user: email;
2. settings: user_id
3. account: user_id
4. goal: user_id
5. account_transaction: account_id, created_at DESC. 
**Пояснение**: Транзакции всегда будут запрашиваться по конкретному(ым) счетам. И логично, что сначала нужно подгрузить только 100 последних транзакций, а не 100 первых и не 100 рандомных, поэтому для такого запроса (100 последних) нужен индекс (account_id, created_at DESC). Сначала отсечём всех пользователей и потом отсортируем оставшиеся. В другом порядке столбцы в индексе бессмысленно, тогда планировщик не сможет использовать такой индекс при фильтрации транзакций по WHERE account_id = n.
6. category: user_id. subcategory: user_id
7. place: user_id

## Отчёты пользователю:

Запросы:

1. Суммарный доход по месяцам
2. Суммарный расход по месяцам
3. Сумма трат по категориям по месяцам
4. Доход по вкладу (за весь период)
5. Максимальная трата по категориям

Индексы:

1. account: user_id
deposit: user_id
credit: user_id
2. -
3. transaction: account_id, created_at DESC
4. -
5. -

## Отчёты разработчикам (метрики):

Запросы:

1. Среднее кол-во целей у одного пользователя
2. Количество выполненных целей по пользователям
3. Среднее кол-во активов, пассивов у пользователя
4. Средний заработок в месяц
5. Сколько категорий у пользователя
6. Средние траты по категориям (медиана)
7. Количество пользователей по тарифам
8. Ежемесячная выручка по тарифам
9. У скольких людей пассивов больше, чем активов
10. Сегментация пользователей по ежемесячному заработку
